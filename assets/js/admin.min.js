jQuery(document).ready(function(s){function e(e){"hide"===e?s(".cmb2-id-leco-cp-current-phase, .cmb2-id-leco-cp-next-phase, .cmb2-id-leco-cp-completion-date").hide():s(".cmb2-id-leco-cp-current-phase, .cmb2-id-leco-cp-next-phase, .cmb2-id-leco-cp-completion-date").show()}if(0<s("#leco_cp_client").length&&s("select#leco_cp_client").select2(),s(document).on("click",".leco_cp_save, #leco_cp_save",function(e){s("#publish").click(),e.preventDefault()}),s("#leco_cp_template").on("change",function(){if(s(this).next(".button").remove(),s(this).next(".button-primary").remove(),"0"!==s(this).val()){var e={action:"leco_cp_get_permalink",post_id:s(this).val(),_wpnonce:lecoCPAdminVars._wpnonce},t=s(this);s.post(ajaxurl,e,function(e){-1!=e&&s('<a id="leco_cp_template_preview" href="'+e+'" class="button button-large" target="_blank">Preview</a> ').insertAfter(t)}),s('<input id="leco_cp_save" class="button button-primary button-large leco_cp_save" type="button" name="leco_cp_template_submit" value="Use This Template">').insertAfter(s(this)),s("#leco_cp_custom_branding, #leco_cp_info").hide()}else s("#leco_cp_custom_branding, #leco_cp_info").show()}),0<s("#leco_cp_show_project_status").length){var t=s("#leco_cp_show_project_status");e(t.val()),t.on("change",function(){e(s(this).val())})}function r(e,t){e.hasClass("module-type-group")?(e.children(".module-type").hide(),e.children(".module-type-"+t).show()):(e.find(".module-type").hide(),e.find(".module-type-"+t).show())}function p(e,t){var n=t.children(".module-type-content-page").find(".cmb2_select");switch(e){case"content_page":t.children(".module-type-files").hide(),t.children(".module-type-private-files").hide(),t.children(".module-type-url").hide(),t.children(".module-type-client-uploads").hide();var o=n.next(".add-new-content-page"),a=n.val(),i={},l=t.children(".module-type-content-page");if("1"===lecoCPAdminVars.supportComments&&d(n,l),"0"!==a&&(i={action:"leco_cp_get_permalink",post_id:a,permalink:lecoCPAdminVars.permalink,_wpnonce:lecoCPAdminVars._wpnonce},s.post(ajaxurl,i,function(e){-1!=e&&(n.nextAll(".preview-content-page").remove(),n.nextAll(".edit-content-page").remove(),s('<a href="'+e+'" class="button button-large preview-content-page" target="_blank">Preview</a> ').insertAfter(n.next(".add-new-content-page")).after('<a href="post.php?post='+n.val()+"&action=edit&parent_id="+s("#post_ID").val()+'" class="button button-large edit-content-page" target="_blank">Edit</a> '))})),!o.length){var c="0"!==a?"display:none":"";n.after('<a href="javascript:void(0)" class="button button-large button-primary add-new-content-page" style="'+c+'">Add Now</a>')}break;default:m(n),r(t,e)}}function d(n,o){n.children("option").each(function(){var t=s(this);if("selected"!==t.attr("selected")){var e={action:"leco_cp_content_page_has_comment",post_id:t.attr("value"),_wpnonce:lecoCPAdminVars._wpnonce};s.post(ajaxurl,e,function(e){0<parseInt(e)&&e!==s("#post_ID").val()&&t.attr("disabled","disabled"),o.show(),o.find(".add-new-content-page").length||n.after('<a href="javascript:void(0)" class="button button-large button-primary add-new-content-page">Add Now</a>')})}})}function u(e){var t=s(e).next(".cmb-field-list").children(":first-child").find("input.regular-text").val(),n=s(e).html();if(1<s(e).children().length){var o=s(e).children(":first-child")[0].outerHTML;s(e).html(o+"<span> - "+t+"</span>")}else s(e).html(n+"<span> - "+t+"</span>")}function n(e){return e.id?s('<img class="icon" src="'+lecoCPAdminVars.iconURL+"caviar/"+e.id.toLowerCase()+'.svg" width="18" height="18" style="vertical-align:middle" /> <span>'+e.text+"</span>"):e.text}function m(e){e.val("0"),e.nextAll(".preview-content-page").remove(),e.nextAll(".edit-content-page").remove()}s(".module-type-select").each(function(){p(s(this).find("select").val(),s(this).parent(".module-type-group"))}),s(".cmb-group-title").each(function(e,t){0<e&&u(t)});var h={templateResult:n,templateSelection:n,width:"40%"};s(".select2-icon").select2(h),s(document).on("cmb2_add_row",function(e,t){t.find("span.select2").remove(),t.find("select.select2-icon").removeClass("select2-hidden-accessible").select2(h),r(t,"url")}).on("cmb_init",function(){s(".cmb-remove-row-button, .cmb-remove-group-row").on("click",function(e){var t="";t="leco_cp_phases_repeat"===s(this).data("selector")?"Remove this phase will DELETE all its modules.\r\nAre you sure?":"Are you sure to remove this module?",confirm(t)||e.stopImmediatePropagation()})}).on("cmb_media_modal_init",function(e,o){if(-1!==o.field.indexOf("private_files")){var a=window.CMB2,i=window.CMB2.mediaHandlers,l=o.isList,c=o.field;o.frames[c].on("ready",function(){o.frames[c].uploader.options.uploader.params.type="leco_private_file"}),o.frames[c].on("select",function(){for(var e=o.frames[c].state().get("selection"),t=l?"list":"single",n=0;n<e.models.length;n++)e.models[n].attributes.url=lecoCPAdminVars.permalink+"file/"+btoa(s("#post_ID").val()+"|"+e.models[n].id)+"/"+e.models[n].attributes.filename;a.attach_id&&l?s('[data-ifd="'+a.attach_id+'"]').parents("li").replaceWith(i.list(e,!0)):i[t](e),a.trigger("cmb_media_modal_select",e,o)})}}).on("cmb_media_modal_open",function(e,t,n){if(-1!==n.field.indexOf("private_files")){var o=window.CMB2.mediaHandlers,a=n.field;n.frames[a].off("select",o.selectFile)}}).on("click",".cmb-shift-rows",function(e){var t=s(this),n=t.parents(".cmb-repeatable-grouping"),o=t.hasClass("move-up")?n.prev(".cmb-repeatable-grouping"):n.next(".cmb-repeatable-grouping");u(n.find(".cmb-group-title")),u(o.find(".cmb-group-title")),s(".select2-icon").select2(h);var a=o.find(".module-type-select").find("select").val(),i=o.find(".module-type-select").parent(".module-type-group"),l=n.find(".module-type-select").find("select").val(),c=n.find(".module-type-select").parent(".module-type-group");p(a,i),p(l,c)}).on("change",".module-type-select select",function(){var e=s(this).val(),t=s(this).parents(".module-type-group"),n=t.children(".module-type-content-page").find(".cmb2_select");switch(e){case"content_page":t.children(".module-type-url").hide(),t.children(".module-type-files").hide(),t.children(".module-type-private-files").hide(),t.children(".module-type-client-uploads").hide();var o=t.children(".module-type-content-page");"1"===lecoCPAdminVars.supportComments?d(n,o):(o.show(),o.find(".add-new-content-page").length?(o.find(".add-new-content-page").show(),o.find(".preview-content-page").remove(),o.find(".edit-content-page").remove()):n.after('<a href="javascript:void(0)" class="button button-large button-primary add-new-content-page">Add Now</a>'));break;default:m(n),r(t,e)}}).on("change",".module-type-content-page select",function(){if("0"!==s(this).val()){var t=s(this).next(".add-new-content-page"),e={action:"leco_cp_get_permalink",post_id:s(this).val(),permalink:lecoCPAdminVars.permalink,_wpnonce:lecoCPAdminVars._wpnonce},n=s(this);t.hide(),s.post(ajaxurl,e,function(e){-1!=e&&(n.nextAll(".preview-content-page").remove(),n.nextAll(".edit-content-page").remove(),s('<a href="'+e+'" class="button button-large preview-content-page" target="_blank">Preview</a> ').insertAfter(t).after('<a href="post.php?post='+n.val()+"&action=edit&parent_id="+s("#post_ID").val()+'" class="button button-large edit-content-page" target="_blank">Edit</a> '))})}else s(this).next(".add-new-content-page").show(),s(this).nextAll(".preview-content-page").remove(),s(this).nextAll(".edit-content-page").remove()}).on("click",".module-type-content-page .add-new-content-page",function(e){e.preventDefault(),s(this).html("Adding...");var t=lecoCPAdminVars.permalink,n=s(this).closest(".cmb-field-list"),o=n.find(".module-title").find("input").val(),a=n.find(".module-desc").find("textarea").val(),i={action:"leco_cp_add_content_page",title:o,content:a,post_id:s("#post_ID").val(),_wpnonce:lecoCPAdminVars._wpnonce},l=s(this);s.post(ajaxurl,i,function(e){-1!=e&&(e=JSON.parse(e),l.prev("select").children("option").removeAttr("selected"),s(".module-type-content-page select").append('<option value="'+e.ID+'">'+o+"</option>"),l.prev("select").children("option").last().attr("selected","selected"),l.after('<code class="just-created-content-page">You just create a new content page - '+o+"!</code>"),s(".just-created-content-page").fadeOut(1e3,"linear"),l.html("Add New"),l.hide(),s('<a href="'+t+"module/"+e.post_name+'/" class="button button-large preview-content-page" target="_blank">Preview</a> ').insertAfter(l).after('<a href="post.php?post='+e.ID+"&action=edit&parent_id="+s("#post_ID").val()+'" class="button button-large edit-content-page" target="_blank">Edit</a> '))})}).on("click",".leco-cp-notice.is-dismissible .notice-dismiss",function(){var e=s(this).closest(".leco-cp-notice"),t=e.attr("id"),n=e.attr("data-nonce");s.post(ajaxurl,{action:"leco_cp_dismiss_notice",nonce:n,notice:t})}),s("#leco_cp_public_portal").on("change",function(){"yes"===s(this).val()&&(confirm("Are you sure you want to make this portal public?\r\n\r\nPublic means it’s visible to anybody with the URL. Please don’t share any passwords or private information in a public portal.")?s(this).val("yes"):s(this).val("no"))}),"undefined"!=typeof typenow&&"leco_content_page"===typenow&&"1"===lecoCPAdminVars.supportComments&&0<s(".leco-project-link.private").length&&1<s(".leco-project-link").length&&s("#comment_status").attr("disabled","disabled")});